<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professional Event Registration System â€” Ticket Generator</title>
  <style>
    :root{
      --primary:#005aff;
      --bg-1: #0f172a;
      --bg-2: #1e293b;
      --glass: rgba(255,255,255,0.10);
      --muted: #cbd5e1;
      --card-shadow: 0 8px 25px rgba(2,6,23,0.6);
      --white:#ffffff;
      --success: #10b981;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter, "Segoe UI", system-ui, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
      color:var(--white);-webkit-font-smoothing:antialiased;padding:28px;
    }

    /* --- ENHANCED HEADER --- */
    header{ text-align:center;margin-bottom:24px }
    
    .logo-container {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 22px;
      box-shadow: 0 0 20px rgba(0, 90, 255, 0.4);
      animation: pulse 2s infinite ease-in-out;
    }

    header h1 { 
      margin: 0; 
      font-size: 36px; 
      letter-spacing: -1px;
      background: linear-gradient(to right, #fff, var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .eye-catchy-sub {
      margin: 8px 0 0;
      font-size: 15px;
      font-weight: 500;
      color: #94a3b8;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 90, 255, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(0, 90, 255, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 90, 255, 0); }
    }

    /* --- NOTIFICATION DIV --- */
    #notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(150%);
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 1000;
      font-weight: 600;
    }
    #notification.show { transform: translateX(0); }

    .container{ max-width:1100px;margin:0 auto; display:grid; grid-template-columns: 1fr 380px; gap:22px; align-items:start; }

    /* Events column */
    .card{ background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border-radius:12px; padding:18px; border:1px solid rgba(255,255,255,0.06); box-shadow:var(--card-shadow); }
    #event-list{ display:grid; gap:14px; }

    .event-card{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      padding:12px; border-radius:10px; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03);
    }
    .event-info{flex:1}
    .event-info h3{ margin:0;font-size:16px }
    .event-info p{ margin:6px 0 0 0;color:var(--muted); font-size:13px }

    .actions{ display:flex; gap:8px }
    .btn{ padding:8px 12px;border-radius:10px;border:none; cursor:pointer; font-weight:600 }
    .btn-primary{ background:var(--primary); color:white; box-shadow:0 8px 18px rgba(0,90,255,0.12) }
    .btn-primary:hover{ background: #2161b9; transition: 0.5s ease; }
    .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,0.05); color:var(--white) }
    .btn-ghost:hover{ background: #585858; transition: 0.5s ease; }
    #modal .btn-ghost, #details-modal .btn-ghost{ background: #494949; }
    #modal .btn-ghost:hover, #details-modal .btn-ghost:hover{ background: #585858; transition: 0.5s ease; }

    /* Right column - ticket preview & admin */
    .right { position:sticky; top:28px; display:flex; flex-direction:column; gap:14px; }
    .small{ font-size:13px; color:var(--muted) }

    /* Modal */
    .modal-back{ position:fixed; inset:0; background: rgba(2,6,23,0.6); display:none; align-items:center; justify-content:center; z-index:80; padding:18px; }
    .modal{ width:100%; max-width:520px; background:var(--white); color:#061428; border-radius:12px; padding:18px; box-shadow:0 30px 80px rgba(2,6,23,0.6); }
    .modal h3{ margin:0 0 10px 0 }
    .form-row{ display:flex; gap:10px; margin-top:8px }
    .form-row input, .form-row select{ flex:1; padding:10px; border-radius:8px; border:1px solid #e6eefc; outline:none; }
    .modal .btn{ margin-top:12px }

    /* Ticket preview (white) */
    #ticket-preview-wrap{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); }
    #ticket-preview{ width:100%; max-width:540px; margin:0 auto; background:white; color:#061428; border-radius:10px; padding:12px; box-shadow:0 10px 30px rgba(2,6,23,0.15); }
    .ticket-row{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-direction: column; }
    .ticket-left{ display: flex; flex-direction: column; text-align: left; }
    .ticket-title{ font-size:14px; font-weight:700; margin:0 0 6px 0; text-align: center; }
    .ticket-sub{ margin:0;color:#334155;font-size:13px; text-align: center; }
    .ticket-meta{ display:flex; gap:10px; margin-top:10px; flex-direction: column; align-items: center;}
    .meta-box{ background:#f8fafc; color:#0f172a; border-radius:8px; font-size:13px; ; text-align:left; box-shadow:0 6px 18px rgba(2,6,23,0.06) }

    .qr-wrap{ width:120px; height:120px; background:white; display:flex; align-items:center; justify-content:center; border-radius:8px; border:1px solid #e6eefc }
    .actions-row{ display:flex; gap:8px; margin-top:12px; justify-content:center }

    /* Download button style */
    .download-btn{ background: #0b1220; color:white; padding:10px 14px; border-radius:10px; border:none; cursor:pointer }
    .download-btn:disabled { background: #64748b; cursor: not-allowed; opacity: 0.6; }
    #clear-demo{ background: #0b1220; color:white; padding:10px 14px; border-radius:10px; border:none; cursor:pointer }

    /* Sort Control Style */
    .sort-container { display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .sort-bar { display: flex; justify-content: flex-end; align-items: center; gap: 10px; }
    .sort-bar select { background: var(--bg-2); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 6px; outline: none; cursor: pointer; }

    /* Responsive */
    @media (max-width:980px){ 
      .container{ grid-template-columns:1fr } 
      .right{ position:relative; top:0 } 
      .modal{ max-width:100% } 
    }

    /* Mobile specific sorting alignment */
    @media (max-width: 600px) {
      .sort-container { flex-direction: column; align-items: flex-start; gap: 10px; }
      .sort-bar { width: 100%; justify-content: flex-start; }
    }
  </style>
</head>
<body>
  <div id="notification">
    <span>âœ… Ticket Generated Successfully!</span>
  </div>

  <header>
    <div class="logo-container">
      <div class="logo-icon">T</div>
      <h1>TicketGen</h1>
    </div>
    <div class="eye-catchy-sub">
        âœ¨ Claim Your Spot. Experience the Future. ðŸš€
    </div>
  </header>

  <div class="container">
    <div class="card">
      <div class="sort-container">
        <h2 style="margin:0">Upcoming Events</h2>
        <div class="sort-bar">
          <label class="small">Sort by:</label>
          <select id="sort-select" onchange="sortEvents()">
            <option value="none">Default</option>
            <option value="asc">Date (Earliest)</option>
            <option value="desc">Date (Latest)</option>
          </select>
        </div>
      </div>
      
      <div id="event-list">
        <div class="event-card" data-date="12 Feb 2025">
          <div class="event-info">
            <h3>Tech Innovation Summit 2025</h3>
            <p class="small">12 Feb 2025 â€¢ AMC Engineering College â€¢ Bengaluru</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('AMC Engineering College','Tech Innovation Summit 2025','12 Feb 2025','Bengaluru')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('Tech Innovation Summit 2025', '12 Feb 2025', 'AMC Engineering College, Bengaluru', 'Exploring the next frontier of web technology and hardware integration.', 'Dr. Aris Thorne', '09:00 AM - 04:00 PM')">Details</button>
          </div>
        </div>

        <div class="event-card" data-date="22 Mar 2025">
          <div class="event-info">
            <h3>AI & Machine Learning Expo</h3>
            <p class="small">22 Mar 2025 â€¢ Indian Institute of Technology â€¢ Chennai</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('Indian Institute of Technology','AI & Machine Learning Expo','22 Mar 2025','Chennai')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('AI & Machine Learning Expo', '22 Mar 2025', 'IIT Chennai', 'Hands-on exhibition of neural network models and robotics.', 'Prof. Sarah Jenkins', '10:00 AM - 05:00 PM')">Details</button>
          </div>
        </div>

        <div class="event-card" data-date="5 Apr 2025">
          <div class="event-info">
            <h3>Startup Growth Conference</h3>
            <p class="small">5 Apr 2025 â€¢ Kumaraguru College of Technology â€¢ Coimbatore</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('Kumaraguru College of Technology','Startup Growth Conference','5 Apr 2025','Coimbatore')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('Startup Growth Conference', '5 Apr 2025', 'KCT Coimbatore', 'Networking and scaling strategies for early-stage tech startups.', 'Elon Tusk', '09:30 AM - 06:00 PM')">Details</button>
          </div>
        </div>

        <div class="event-card" data-date="15 May 2025">
          <div class="event-info">
            <h3>Cyber Security Workshop</h3>
            <p class="small">15 May 2025 â€¢ Chennai Institute of Technology â€¢ Chennai</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('Chennai Institute of Technology','Cyber Security Workshop','15 May 2025','Chennai')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('Cyber Security Workshop', '15 May 2025', 'CIT Chennai', 'Deep dive into network security and ethical hacking practices.', 'Kevin Mitnick Jr.', '08:00 AM - 02:00 PM')">Details</button>
          </div>
        </div>

        <div class="event-card" data-date="30 Jun 2025">
          <div class="event-info">
            <h3>Cloud Computing Summit</h3>
            <p class="small">30 Jun 2025 â€¢ Erode Sengunthar Engineering College â€¢ Erode</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('Erode Sengunthar Engineering College','Cloud Computing Summit','30 Jun 2025','Erode')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('Cloud Computing Summit', '30 Jun 2025', 'ESEC Erode', 'Future of serverless architecture and multi-cloud environments.', 'Satya Nadella (Virtual)', '11:00 AM - 03:00 PM')">Details</button>
          </div>
        </div>

        <div class="event-card" data-date="18 Jul 2025">
          <div class="event-info">
            <h3>Digital Marketing Masterclass</h3>
            <p class="small">18 Jul 2025 â€¢ KPR Institute of Engineering and Technology â€¢ Coimbatore</p>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="openRegister('KPR Institute of Engineering and Technology','Digital Marketing Masterclass','18 Jul 2025','Coimbatore')">Register</button>
            <button class="btn btn-ghost" onclick="viewDetails('Digital Marketing Masterclass', '18 Jul 2025', 'KPR Coimbatore', 'Mastering SEO, SEM, and social media algorithms in 2025.', 'Gary Vaynerchuk', '10:00 AM - 04:00 PM')">Details</button>
          </div>
        </div>

      </div>
    </div>

    <aside class="right">
      <div class="card">
        <h3 style="margin-top:0">Ticket Preview</h3>
        <p class="small">Your ticket for the event appear here after registration and you can download it.</p>

        <div id="ticket-preview-wrap" style="margin-top:12px">
          <div id="ticket-preview" aria-live="polite">
            <div class="ticket-row">
                <div style="font-weight: bold; font-size: larger; text-align: center;" id="tp-college">Institution Name</div>
                <div class="ticket-left">
                    <div class="ticket-title" id="tp-event">Select an event to generate ticket</div>
                    <p class="ticket-sub" id="tp-sub">Participant details will appear after you register.</p>
                    <div class="ticket-meta">
                        <div class="meta-box" id="tp-name">Name : â€”</div>
                        <div class="meta-box" id="tp-email">Email : â€”</div>
                        <div class="meta-box" id="tp-id">Ticket ID : â€”</div>
                    </div>
                </div>
              <div class="qr-wrap" id="tp-qr">
                <img src="" alt="QR" style="max-width:100%; border-radius:6px" id="tp-qr-img">
              </div>
            </div>

            <div style="margin-top:14px; display:flex; justify-content:space-between; align-items:center">
              <div style="font-size:13px;color:#475569">
                <div id="tp-date">Date : â€”</div>
                <div id="tp-loc">Location : â€”</div>
              </div>
              <div style="text-align:right; color:#0f172a; font-size:12px">
                <div style="background:#e2e8f0; padding:6px 8px; border-radius:6px; display:inline-block; font-weight:700" id="tp-type">ENTRY</div>
              </div>
            </div>

            <div class="actions-row">
              <button id="download-btn" class="download-btn" disabled>Download Ticket (PNG)</button>
              <button class="btn btn-ghost" id="clear-demo" onclick="clearTicket()">Clear Ticket</button>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <div id="modal" class="modal-back" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h3 id="modal-title">Register</h3>
      <div style="margin-top:8px" class="small" id="modal-sub"></div>

      <div class="form-row" style="margin-top:12px">
        <input id="input-name" type="text" placeholder="Full name" aria-label="Full name" />
      </div>
      <div class="form-row">
        <input id="input-email" type="email" placeholder="Email address" aria-label="Email" />
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:14px">
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="submitRegistration()">Generate Ticket</button>
      </div>
    </div>
  </div>

  <div id="details-modal" class="modal-back" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" style="max-width: 400px; color: #0f172a;">
      <h3 id="det-title" style="color: var(--primary);">Event Details</h3>
      <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
      <p><strong>Date:</strong> <span id="det-date"></span></p>
      <p><strong>Place:</strong> <span id="det-place"></span></p>
      <p><strong>Timing:</strong> <span id="det-time"></span></p>
      <p><strong>Chief Guest:</strong> <span id="det-guest"></span></p>
      <p><strong>Description:</strong> <span id="det-desc"></span></p>
      
      <div style="display:flex; justify-content:flex-end; margin-top:14px">
        <button class="btn btn-ghost" onclick="closeDetails()" style="color:white">Close</button>
      </div>
    </div>
  </div>

  <script>
    let selected = {college:'',  name:'', date:'', loc:'' };

    function showNotification() {
      const notify = document.getElementById('notification');
      notify.classList.add('show');
      setTimeout(() => {
        notify.classList.remove('show');
      }, 3000);
    }

    function sortEvents() {
      const list = document.getElementById('event-list');
      const order = document.getElementById('sort-select').value;
      const cards = Array.from(list.getElementsByClassName('event-card'));

      if (order === 'none') return;

      cards.sort((a, b) => {
        const dateA = new Date(a.getAttribute('data-date'));
        const dateB = new Date(b.getAttribute('data-date'));
        return order === 'asc' ? dateA - dateB : dateB - dateA;
      });

      list.innerHTML = '';
      cards.forEach(card => list.appendChild(card));
    }

    function openRegister(college, name, date, loc){
      selected = {college, name, date, loc };
      document.getElementById('modal-title').innerText = 'Register â€” ' + name;
      document.getElementById('modal-sub').innerText = date + ' â€¢ ' + college + ' â€¢ ' + loc;
      document.getElementById('modal-sub').style.color="#000";
      document.getElementById('input-name').value = '';
      document.getElementById('input-email').value = '';
      document.getElementById('modal').style.display = 'flex';
      document.getElementById('modal').setAttribute('aria-hidden','false');
      document.getElementById('input-name').focus();
    }

    function closeModal(){
      document.getElementById('modal').style.display = 'none';
      document.getElementById('modal').setAttribute('aria-hidden','true');
    }

    function viewDetails(name, date, place, desc, guest, time) {
      document.getElementById('det-title').innerText = name;
      document.getElementById('det-date').innerText = date;
      document.getElementById('det-place').innerText = place;
      document.getElementById('det-desc').innerText = desc;
      document.getElementById('det-guest').innerText = guest;
      document.getElementById('det-time').innerText = time;
      
      document.getElementById('details-modal').style.display = 'flex';
      document.getElementById('details-modal').setAttribute('aria-hidden','false');
    }

    function closeDetails() {
      document.getElementById('details-modal').style.display = 'none';
      document.getElementById('details-modal').setAttribute('aria-hidden','true');
    }

    function genTicketId(){
      const rand = Math.floor(Math.random()*90000)+10000;
      return 'TKT-' + rand;
    }

    async function submitRegistration(){
      const name = document.getElementById('input-name').value.trim();
      const email = document.getElementById('input-email').value.trim();
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if(!name) return alert('Please enter your full name.');
      if(!email) return alert('Please enter your email address.');
      if(!emailRegex.test(email)) {
        return alert('âš ï¸ WARNING: Invalid Email Format\n\nPlease enter a valid email address.');
      }

      const ticketId = genTicketId();
      document.getElementById('tp-college').innerText = selected.college;
      document.getElementById('tp-event').innerText = selected.name;
      document.getElementById('tp-name').innerText = 'Name: ' + name;
      document.getElementById('tp-email').innerText = 'Email: ' + email;
      document.getElementById('tp-id').innerText = 'Ticket ID: ' + ticketId;
      document.getElementById('tp-date').innerText = 'Date: ' + selected.date;
      document.getElementById('tp-loc').innerText = 'Location: ' + selected.loc;

      const qrPayload = `EVENT DETAILS\n--------------\nEvent: ${selected.name}\nInstitution: ${selected.college}\nDate: ${selected.date}\nLocation: ${selected.loc}\n\nATTENDEE INFO\n--------------\nName: ${name}\nTicket ID: ${ticketId}`;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${encodeURIComponent(qrPayload)}&format=png`;

      const qrImg = document.getElementById('tp-qr-img');
      qrImg.src = qrUrl;
      qrImg.alt = 'QR code for ticket ' + ticketId;

      const downloadBtn = document.getElementById('download-btn');
      downloadBtn.disabled = false;

      window.__currentTicket = { name, email, college: selected.college, event: selected.name, date: selected.date, loc: selected.loc, ticketId, qrUrl };

      closeModal();
      showNotification();
      document.getElementById('ticket-preview').scrollIntoView({ behavior:'smooth' });
    }

    async function drawTicketPNG(ticket){
      const W = 600, H = 350;
      const canvas = document.createElement('canvas');
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext('2d');

      const gradient = ctx.createLinearGradient(0, 0, W, H);
      gradient.addColorStop(0, "#f8fbff");
      gradient.addColorStop(1, "#e3eeff");
      ctx.fillStyle = gradient;
      ctx.fillRect(0,0,W,H);

      const padding = 20;
      ctx.fillStyle = '#061428';
      ctx.font = '700 20px Inter, "Segoe UI", system-ui, Arial';
      ctx.fillText(ticket.college, padding, 50);
      ctx.fillText(ticket.event, padding, 80);

      ctx.font = '400 13px Inter, "Segoe UI"';
      ctx.fillStyle = '#475569';
      ctx.fillText(ticket.date + ' â€¢ ' + ticket.loc, padding, 100);

      ctx.fillStyle = '#f1f5f9';
      ctx.fillRect(padding, 120, W - padding*2, 1);

      ctx.fillStyle = '#0f172a';
      ctx.font = '600 15px Inter, "Segoe UI"';
      ctx.fillText('Name :', padding, 160);
      ctx.font = '500 15px Inter, "Segoe UI"';
      ctx.fillText(ticket.name, padding + 120, 160);

      ctx.font = '600 15px Inter, "Segoe UI"';
      ctx.fillText('Email :', padding, 190);
      ctx.font = '500 14px Inter, "Segoe UI"';
      ctx.fillText(ticket.email, padding + 120, 190);

      ctx.font = '600 15px Inter, "Segoe UI"';
      ctx.fillText('Ticket ID :', padding, 220);
      ctx.font = '700 15px Inter, "Segoe UI"';
      ctx.fillText(ticket.ticketId, padding + 120, 220);

      const qrSize = 150;
      const qrX = W - 30 - qrSize;
      const qrY = 100;

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(qrX - 6, qrY - 6, qrSize + 12, qrSize + 12);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 1;
      ctx.strokeRect(qrX - 6, qrY - 6, qrSize + 12, qrSize + 12);

      const img = await loadImage(ticket.qrUrl);
      ctx.drawImage(img, qrX, qrY, qrSize, qrSize);

      // --- ADDED TEXT BELOW QR CODE ---
      ctx.font = '600 10px Inter, "Segoe UI"';
      ctx.fillStyle = '#1e293b';
      ctx.textAlign = 'center';
      ctx.fillText('Scan me to access the Event Details', qrX + (qrSize/2), qrY + qrSize + 22);
      ctx.textAlign = 'left'; // Reset alignment for other text

      ctx.font = '400 12px Inter, "Segoe UI"';
      ctx.fillStyle = '#64748b';
      ctx.fillText('Registered Date & Time :' + new Date().toLocaleDateString() + ' â€¢ ' + new Date().toLocaleTimeString(), padding, H - 68);
      ctx.fillText('Show this ticket at the entrance. ID will be verified.', padding, H - 48);
      ctx.fillText('For Enquiry : ' + selected.college.toLowerCase().replace(/\s+/g, "") + '@gmail.com', padding, H - 28);

      return canvas.toDataURL('image/png');
    }

    function loadImage(url){
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'Anonymous';
        img.onload = ()=> resolve(img);
        img.onerror = (e)=> {
          const c = document.createElement('canvas'); c.width=10; c.height=10; const ctx = c.getContext('2d'); ctx.fillStyle='#fff'; ctx.fillRect(0,0,10,10);
          resolve(c);
        };
        img.src = url;
      });
    }

    document.getElementById('download-btn').addEventListener('click', async function(){
      const t = window.__currentTicket;
      if(!t) return alert('No ticket to download. Generate a ticket first.');
      try{
        this.disabled = true;
        this.innerText = 'Preparing...';
        const dataUrl = await drawTicketPNG({ ticketId: t.ticketId, name: t.name, email: t.email, college:t.college, event: t.event, date: t.date, loc: t.loc, qrUrl: t.qrUrl });
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = `${t.event.replace(/\s+/g,'_')}_${t.ticketId}.png`;
        a.click();
      }catch(err){
        console.error(err);
        alert('Could not prepare ticket image.');
      }finally{
        this.disabled = false;
        this.innerText = 'Download Ticket (PNG)';
      }
    });

    function clearTicket(){
      document.getElementById('tp-college').innerText = 'Institution Name';
      document.getElementById('tp-event').innerText = 'Select an event to generate ticket';
      document.getElementById('tp-sub').innerText = 'Participant details and ticket will appear after you register.';
      document.getElementById('tp-name').innerText = 'Name: â€”';
      document.getElementById('tp-email').innerText = 'Email: â€”';
      document.getElementById('tp-id').innerText = 'Ticket ID: â€”';
      document.getElementById('tp-qr-img').src = '';
      document.getElementById('tp-date').innerText = 'Date: â€”';
      document.getElementById('tp-loc').innerText = 'Location: â€”';
      document.getElementById('download-btn').disabled = true;
      window.__currentTicket = null;
    }

    window.addEventListener('click', function(e){
      if(e.target.className === 'modal-back') {
        closeModal();
        closeDetails();
      }
    });

    window.addEventListener('keydown', function(e){
      if(e.key === 'Escape') {
        closeModal();
        closeDetails();
      }
    });

    clearTicket();
  </script>
</body>
</html>